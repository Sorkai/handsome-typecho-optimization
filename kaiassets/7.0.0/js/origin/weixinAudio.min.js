/*weixinAudio.js*/
(function(){$.fn.weixinAudio=function(e){var weixinIsLoaded=false;function c(a){this.$context=a;this.$Audio=a.children(".WeChatAudio");this.Audio=this.$Audio[0];this.$audio_area=a.find(".audio_area");this.$audio_length=a.find(".audio_length");this.$audio_progress=a.find(".progress_bar");this.currentState="pause";this.time=null;this.settings=$.extend(!0,f,e);this.init()}var g=$(this),f={autoplay:!1,src:""};c.prototype={init:function(){var a=this,b=(new Date).getTime(),c=setInterval(function(){var d=a.updateTotalTime();"00:00"!==d?(clearInterval(c)):8000<(new Date).getTime()-b&&clearInterval(c)},100);this.events();""!==this.settings.src&&this.changeSrc(this.settings.src);this.settings.autoplay&&this.play()},play:function(){"play"===this.currentState?this.pause():(this.Audio.play(),clearInterval(this.timer),this.timer=setInterval(this.run.bind(this),50),this.currentState="play",this.$audio_area.addClass("playing"))},pause:function(){this.Audio.pause();this.currentState="pause";clearInterval(this.timer);this.$audio_area.removeClass("playing")},stop:function(){},events:function(){var a=this,b;a.$audio_area.on("click",function(){if(!weixinIsLoaded){a.Audio.load();weixinIsLoaded=true}a.play();b||(a.updateTotalTime(),b=!0)})},run:function(){this.animateProgressBarPosition();this.Audio.ended&&this.pause()},animateProgressBarPosition:function(){var a=100*this.Audio.currentTime/this.Audio.duration+"%";"NaN%"==a&&(a="0%");this.$audio_progress.css({width:a})},getAudioSeconds:function(a){a=this.addZero(Math.floor(a%60),2);60>a||(a="00");return a},getAudioMinutes:function(a){a=this.addZero(Math.floor(a/60),2);60>a||(a="00");return a},addZero:function(a,b){for(a=String(a);a.length<b;){a="0"+a}return a},updateTotalTime:function(){if(this.Audio){var a=this.Audio.duration,b=this.getAudioMinutes(a);a=this.getAudioSeconds(a);this.$audio_length.text(b+":"+a);return b+":"+a}console.log("\u97f3\u9891\u672a\u52a0\u8f7d\u6210\u529f")},changeSrc:function(a,b){this.pause();this.Audio.src=a;this.play();b()}};var d={};g.each(function(a,b){d["weixinAudio"+a]=new c($(this))});return d}})(jQuery);
