!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Macy=e()}(this,function(){"use strict";function e(t){var e=document.body.clientWidth,n={columns:t.columns},o=void 0;d(t.margin)?n.margin={x:t.margin.x,y:t.margin.y}:n.margin={x:t.margin,y:t.margin};for(var r=Object.keys(t.breakAt),i=r.length-1;0<=i;i--){var s=parseInt(r[i],10);e<=s&&(o=t.breakAt[s],d(o)||(n.columns=o),d(o)&&o.columns&&(n.columns=o.columns),d(o)&&o.margin&&!d(o.margin)&&(n.margin={x:o.margin,y:o.margin}),d(o)&&o.margin&&d(o.margin)&&o.margin.x&&(n.margin.x=o.margin.x),d(o)&&o.margin&&d(o.margin)&&o.margin.y&&(n.margin.y=o.margin.y))}return n}function u(t){return e(t).columns}function p(t){return e(t).margin}function m(t,e){var n=!(1<arguments.length&&void 0!==e)||e,o=u(t),r=p(t).x,i=100/o;return n?1===o?"100%":"calc("+i+"% - "+(r=(o-1)*r/o)+"px)":i}function c(t){for(var e=0,n=t.container,o=t.rows,r=o.length-1;0<=r;r--)e=o[r]>e?o[r]:e;n.style.height=e+"px"}function i(r,t,e,n){var o=2<arguments.length&&void 0!==e&&e,i=!(3<arguments.length&&void 0!==n)||n,s=u(r.options),a=p(r.options).y;l(r,s,o),t.forEach(function(t){r.lastcol===s&&(r.lastcol=0);var e,n,o=(e=t,n="height",window.getComputedStyle(e,null).getPropertyValue(n)),o=parseInt(t.offsetHeight,10);isNaN(o)||(t.style.position="absolute",t.style.top=r.rows[r.lastcol]+"px",t.style.left=""+r.cols[r.lastcol],r.rows[r.lastcol]+=isNaN(o)?0:o+a,r.lastcol+=1,i&&(t.dataset.macyComplete=1))}),i&&(r.tmpRows=null),c(r)}Object.getOwnPropertyNames(Array.prototype).forEach(function(t){"length"!==t&&(NodeList.prototype[t]=Array.prototype[t],HTMLCollection.prototype[t]=Array.prototype[t])});function a(t,e){if(!(this instanceof a))return new a(t,e);if(t=t.replace(/^\s*/,"").replace(/\s*$/,""),e)return this.byCss(t,e);for(var n in this.selectors)if(e=n.split("/"),new RegExp(e[1],e[2]).test(t))return this.selectors[n](t);return this.byCss(t)}a.prototype.byCss=function(t,e){return(e||document).querySelectorAll(t)},(a.prototype.selectors={})[/^\.[\w\-]+$/]=function(t){return document.getElementsByClassName(t.substring(1))},a.prototype.selectors[/^\w+$/]=function(t){return document.getElementsByTagName(t)},a.prototype.selectors[/^\#[\w\-]+$/]=function(t){return document.getElementById(t.substring(1))};function l(t,e){var n,o,r,i,s,a,c=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(t.lastcol||(t.lastcol=0),c){t.rows=[],t.cols=[],t.lastcol=0;for(var l=e-1;0<=l;l--)t.rows[l]=0,t.cols[l]=(o=l,a=s=i=void 0,r=u((n=t).options),a=s=void(i=0),1==++o?0:(s=((a=p(n.options).x)-(r-1)*a/r)*(o-1),"calc("+(i+=m(n.options,!1)*(o-1))+"% + "+s+"px)"))}if(t.tmpRows){t.rows=[];for(l=e-1;0<=l;l--)t.rows[l]=t.tmpRows[l]}else{t.tmpRows=[];for(l=e-1;0<=l;l--)t.tmpRows[l]=t.rows[l]}}function t(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],o=e?t.container.children:a(':scope > *:not([data-macy-complete="1"])',t.container),r=m(t.options);return o.forEach(function(t){e&&(t.dataset.macyComplete=0),t.style.width=r}),(t.options.trueOrder?i:function(o,t,e,n){var r=2<arguments.length&&void 0!==e&&e,i=!(3<arguments.length&&void 0!==n)||n,s=u(o.options),a=p(o.options).y;l(o,s,r),t.forEach(function(t){var n=0,e=parseInt(t.offsetHeight,10);isNaN(e)||(o.rows.forEach(function(t,e){t<o.rows[n]&&(n=e)}),t.style.position="absolute",t.style.top=o.rows[n]+"px",t.style.left=""+o.cols[n],o.rows[n]+=isNaN(e)?0:e+a,i&&(t.dataset.macyComplete=1))}),i&&(o.tmpRows=null),c(o)})(t,o,e,n)}function o(e,n){setTimeout(function(){var t=e();n&&n(t)},0)}function s(t,e,n){t&&o(t),n.req===n.complete&&o(e)}function f(t,e,n){var o=t.length,r=0;t.forEach(function(t){t.complete&&s(e,n,{req:o,complete:++r}),t.addEventListener("load",function(){s(e,n,{req:o,complete:++r})})})}function h(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:y;if(!(this instanceof h))return new h(t);if(this.options={},g(this.options,y,t),this.container=a(t.container),this.container instanceof a||!this.container)return!!t.debug&&console.error("Error: Container not found");delete this.options.container,this.container.length&&(this.container=this.container[0]),this.container.style.position="relative",this.rows=[];var e,n,o,r=this.recalculate.bind(this,!1,!1),i=this.recalculate.bind(this,!0,!0),s=a("img",this.container);if(this.resizer=(e=function(){i()},n=100,o=void 0,function(){o&&clearTimeout(o),o=setTimeout(e,n)}),window.addEventListener("resize",this.resizer),t.waitForImages)return f(s,null,i);this.recalculate(!0,!1),f(s,r,i)}var d=function(t){return t===Object(t)&&"[object Array]"!==Object.prototype.toString.call(t)},g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},y={columns:4,margin:2,trueOrder:!0,waitForImages:!1,breakAt:{}};return h.init=function(t){return console.warn("Depreciated: Macy.init will be removed in v3.0.0 opt to use Macy directly like so Macy({ /*options here*/ }) "),new h(t)},h.prototype.recalculateOnImageLoad=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=a("img",this.container),o=this.recalculate.bind(this,e,!1),r=this.recalculate.bind(this,e,!0);return t?f(n,null,r):(o(),f(n,o,r))},h.prototype.runOnImageLoad=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=a("img",this.container);return f(n,e?t:null,t)},h.prototype.recalculate=function(){return t(this,0<arguments.length&&void 0!==arguments[0]&&arguments[0],!(1<arguments.length&&void 0!==arguments[1])||arguments[1])},h.prototype.remove=function(){window.removeEventListener("resize",this.resizer),this.container.children.forEach(function(t){t.removeAttribute("data-macy-complete"),t.removeAttribute("style")}),this.container.removeAttribute("style")},h.prototype.reInit=function(){this.recalculate(!0,!0),window.addEventListener("resize",this.resizer)},h});